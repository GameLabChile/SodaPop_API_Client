from django.shortcuts import render
import time
import rsa
import base64
import json
import urllib2
# Create your views here.
def index(request):
	teacher = "gamelab@gamelab.cl"
	url = "https://sp-dev.gamelab.cl/api/esc/?teacher="+teacher
	res = urllib2.urlopen(url).read()
	json_obj = json.loads(res)
	return render(request, 'index.html', {'escs':json_obj})

def form(request, esc, player):
	url = "https://sp-dev.gamelab.cl/api/newalone/"
	sign = ""
	teacher = "gamelab@gamelab.cl"
	player = player
	timereq = int(time.time())
	esc = int(esc)
	private_key = rsa.PrivateKey(135029684411836463323964252311790626420400824319263974720208824508437555654491291055113056194717508477434017708517506511910833292985521483489975993602890988197575597070937122972491618562349497007864811663127671552248579928236273284258790781773463479851013106516802197673233261103509191605822028096277111075231, 65537, 50264494574227724174915420287752630150176213590685626856191380177729261451500214177953493735238542148946096037612235666334691685851881869954704260400396125434896645221343051223960866327111196984114078198171257253271590528258718113313362450273038415511547479748000208882114602008719312717006430786322599148385, 50257229368562109885338782933612258651709692866444619540597165173015610870283328852282373562840583893831293648363897477049170184711382683997893270326484073310654099, 2686771358237724223760351067489467424579917667965738372521998271592464919902841310973472093092338759084824283806654525898847227449503529256217669)
	data = {'teacher':teacher, 'player':player, 'time':timereq, 'esc':esc}
	firma = rsa.sign( json.dumps(data, sort_keys=True) , private_key, 'SHA-1' )
	firma64 = base64.urlsafe_b64encode(firma)

	return render(request, 'form.html', {'sign':firma64, 'teacher':teacher, 'player':player, 'time':timereq, 'esc':esc, 'url':url})